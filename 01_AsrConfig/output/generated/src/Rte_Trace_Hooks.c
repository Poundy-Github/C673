// Copyright (C) Continental AG
// All Rights Reserved
// COMPONENT: RTE - RealTimeEnvironment
/// @file  Rte_Trace_Hooks.c
/// @brief This file contains all stuff required for the RTA-Instrumentation of the RTE. Especially it contains the FrameWorkHookfunctions
///        to measure the taskRuntime of the tasks handled by the RTE. It contains also the pre- and postHookFunctions of the runables
///        called in RTE.c.
///        Note: This file is generated by the RteStandardRtaInstrGenerator. Therefore it must not be altered in the sections between the
///              startTag and the related endTag eg. ___GENERATOR_TAG___XXX___SECTION_START___, ___GENERATOR_TAG___XXX___SECTION_END___
///              as these parts are overwritten at next generatorRun. But code can be added manually outside of these sections. This applies also
///              to the generated functions: Before the startTag and after the endTag code can be added manually but not in between these two tags.

#include <Std_Types.h>
#include <Rte_Trace_Hooks.h>
#include <Os.h>
#include <rta.h>
#include <Rte.h>
#include "Rtm.h"
/* The following GENERATOR_TAG indicates the start of the implementation related to taskConfiguration type.
 * All the lines above the GENERATOR_TAG will not be changed by the codeGenerator at all.
 * DO NOT change or remove this comment block as it is needed by codeGenerator adding the rtaInstrumentation (GenerateRteStandardRtaInstrumentation)!!!
 * ___GENERATOR_TAG___TASK_CFG_TYPE___SECTION_START___ */

typedef struct
{
  TaskType taskId;
  uint8    u_globalId;
  uint8    u_localId;
  boolean  b_taskRuntimeEnabled;
  boolean  b_isExtendedTask;
}RTE_TraceHooksTaskCfg;


#define RTE_NO_RELEVANT_TASKS (26)

/* ___GENERATOR_TAG___TASK_CFG_TYPE___SECTION_END___
 * The GENERATOR_TAG above indicates the end of the implementation related to taskConfiguration type.
 * All the lines below the GENERATOR_TAG will not be changed by the codeGenerator at all.
 * DO NOT change or remove this comment block as it is needed by codeGenerator adding the rtaInstrumentation (GenerateRteStandardRtaInstrumentation)!!!
 */





/* The following GENERATOR_TAG indicates the start of the implementation related to taskLut.
 * All the lines above the GENERATOR_TAG will not be changed by the codeGenerator at all.
 * DO NOT change or remove this comment block as it is needed by codeGenerator adding the rtaInstrumentation (GenerateRteStandardRtaInstrumentation)!!!
 * ___GENERATOR_TAG___TASK_LUT___SECTION_START___ */

static const RTE_TraceHooksTaskCfg a_TASK_CFG_LUT[RTE_NO_RELEVANT_TASKS] =
{
  /* taskId                                    , u_globalId                                             , u_localId                                              , b_taskRuntimeEnabled, b_isExtendedTask */
  {(TaskType)Core0_OsTask_Bsw_20ms             , (uint8)RTE_GLOBAL_ID_Core0_OsTask_Bsw_20ms             , (uint8)RTE_Core0OsTaskBsw20ms_TaskRuntime              , b_TRUE              , b_FALSE         },
  {(TaskType)Core0_OsTask_Bsw_5ms              , (uint8)RTE_GLOBAL_ID_Core0_OsTask_Bsw_5ms              , (uint8)RTE_Core0OsTaskBsw5ms_TaskRuntime               , b_TRUE              , b_TRUE          },
  {(TaskType)Core0_OsTask_Bsw_10ms             , (uint8)RTE_GLOBAL_ID_Core0_OsTask_Bsw_10ms             , (uint8)RTE_Core0OsTaskBsw10ms_TaskRuntime              , b_TRUE              , b_FALSE         },
  {(TaskType)Core0_InitTask_Appl               , (uint8)RTE_GLOBAL_ID_Core0_InitTask_Appl               , (uint8)RTE_Core0InitTaskAppl_TaskRuntime               , b_TRUE              , b_FALSE         },
  {(TaskType)Core0_OsTask_Appl_5ms             , (uint8)RTE_GLOBAL_ID_Core0_OsTask_Appl_5ms             , (uint8)RTE_Core0OsTaskAppl5ms_TaskRuntime              , b_TRUE              , b_FALSE         },
  {(TaskType)Core0_OsTask_Appl_10ms            , (uint8)RTE_GLOBAL_ID_Core0_OsTask_Appl_10ms            , (uint8)RTE_Core0OsTaskAppl10ms_TaskRuntime             , b_TRUE              , b_FALSE         },
  {(TaskType)Core0_OsTask_OperationInovkedProxy, (uint8)RTE_GLOBAL_ID_Core0_OsTask_OperationInovkedProxy, (uint8)RTE_Core0OsTaskOperationInovkedProxy_TaskRuntime, b_TRUE              , b_TRUE          },
  {(TaskType)Core0_OsTask_Appl_20ms            , (uint8)RTE_GLOBAL_ID_Core0_OsTask_Appl_20ms            , (uint8)RTE_Core0OsTaskAppl20ms_TaskRuntime             , b_TRUE              , b_TRUE          },
  {(TaskType)Core0_OsTask_FunctionSafety_5ms   , (uint8)RTE_GLOBAL_ID_Core0_OsTask_FunctionSafety_5ms   , (uint8)RTE_Core0OsTaskFunctionSafety5ms_TaskRuntime    , b_TRUE              , b_FALSE         },
  {(TaskType)Core0_OsTask_Appl_60ms            , (uint8)RTE_GLOBAL_ID_Core0_OsTask_Appl_60ms            , (uint8)RTE_Core0OsTaskAppl60ms_TaskRuntime             , b_TRUE              , b_TRUE          },
  {(TaskType)Core1_OsTask_Appl_10ms            , (uint8)RTE_GLOBAL_ID_Core1_OsTask_Appl_10ms            , (uint8)RTE_Core1OsTaskAppl10ms_TaskRuntime             , b_TRUE              , b_TRUE          },
  {(TaskType)Core1_OsTask_Bsw_20ms             , (uint8)RTE_GLOBAL_ID_Core1_OsTask_Bsw_20ms             , (uint8)RTE_Core1OsTaskBsw20ms_TaskRuntime              , b_TRUE              , b_TRUE          },
  {(TaskType)Core1_OsTask_OperationInovkedProxy, (uint8)RTE_GLOBAL_ID_Core1_OsTask_OperationInovkedProxy, (uint8)RTE_Core1OsTaskOperationInovkedProxy_TaskRuntime, b_TRUE              , b_FALSE         },
  {(TaskType)Core1_InitTask_Appl               , (uint8)RTE_GLOBAL_ID_Core1_InitTask_Appl               , (uint8)RTE_Core1InitTaskAppl_TaskRuntime               , b_TRUE              , b_FALSE         },
  {(TaskType)Core1_OsTask_Appl_60ms            , (uint8)RTE_GLOBAL_ID_Core1_OsTask_Appl_60ms            , (uint8)RTE_Core1OsTaskAppl60ms_TaskRuntime             , b_TRUE              , b_FALSE         },
  {(TaskType)Core1_OsTask_Appl_20ms            , (uint8)RTE_GLOBAL_ID_Core1_OsTask_Appl_20ms            , (uint8)RTE_Core1OsTaskAppl20ms_TaskRuntime             , b_TRUE              , b_FALSE         },
  {(TaskType)Core2_OsTask_Bsw_20ms             , (uint8)RTE_GLOBAL_ID_Core2_OsTask_Bsw_20ms             , (uint8)RTE_Core2OsTaskBsw20ms_TaskRuntime              , b_TRUE              , b_TRUE          },
  {(TaskType)Core2_OsTask_OperationInovkedProxy, (uint8)RTE_GLOBAL_ID_Core2_OsTask_OperationInovkedProxy, (uint8)RTE_Core2OsTaskOperationInovkedProxy_TaskRuntime, b_TRUE              , b_FALSE         },
  {(TaskType)Core2_InitTask_Appl               , (uint8)RTE_GLOBAL_ID_Core2_InitTask_Appl               , (uint8)RTE_Core2InitTaskAppl_TaskRuntime               , b_TRUE              , b_FALSE         },
  {(TaskType)Core2_OsTask_Appl_5ms             , (uint8)RTE_GLOBAL_ID_Core2_OsTask_Appl_5ms             , (uint8)RTE_Core2OsTaskAppl5ms_TaskRuntime              , b_TRUE              , b_TRUE          },
  {(TaskType)Core3_OsTask_Bsw_20ms             , (uint8)RTE_GLOBAL_ID_Core3_OsTask_Bsw_20ms             , (uint8)RTE_Core3OsTaskBsw20ms_TaskRuntime              , b_TRUE              , b_TRUE          },
  {(TaskType)Core3_OsTask_OperationInovkedProxy, (uint8)RTE_GLOBAL_ID_Core3_OsTask_OperationInovkedProxy, (uint8)RTE_Core3OsTaskOperationInovkedProxy_TaskRuntime, b_TRUE              , b_TRUE          },
  {(TaskType)Core3_InitTask_Appl               , (uint8)RTE_GLOBAL_ID_Core3_InitTask_Appl               , (uint8)RTE_Core3InitTaskAppl_TaskRuntime               , b_TRUE              , b_FALSE         },
  {(TaskType)Core3_OsTask_Appl_50ms            , (uint8)RTE_GLOBAL_ID_Core3_OsTask_Appl_50ms            , (uint8)RTE_Core3OsTaskAppl50ms_TaskRuntime             , b_TRUE              , b_FALSE         },
  {(TaskType)Core3_OsTask_Appl_10ms            , (uint8)RTE_GLOBAL_ID_Core3_OsTask_Appl_10ms            , (uint8)RTE_Core3OsTaskAppl10ms_TaskRuntime             , b_TRUE              , b_FALSE         },
  {(TaskType)Core3_OsTask_Appl_60ms            , (uint8)RTE_GLOBAL_ID_Core3_OsTask_Appl_60ms            , (uint8)RTE_Core3OsTaskAppl60ms_TaskRuntime             , b_TRUE              , b_FALSE         }
};

/* ___GENERATOR_TAG___TASK_LUT___SECTION_END___
 * The GENERATOR_TAG above indicates the end of the implementation the implementation related to taskLut.
 * All the lines below the GENERATOR_TAG will not be changed by the codeGenerator at all.
 * DO NOT change or remove this comment block as it is needed by codeGenerator adding the rtaInstrumentation (GenerateRteStandardRtaInstrumentation)!!!
 */





/* The following GENERATOR_TAG indicates the start of the taskCycleCounter implementation.
 * All the lines above the GENERATOR_TAG will not be changed by the codeGenerator at all.
 * DO NOT change or remove this comment block as it is needed by codeGenerator adding the rtaInstrumentation (GenerateRteStandardRtaInstrumentation)!!!
 * ___GENERATOR_TAG___TASK_CYCLE_COUNTER___SECTION_START___ */

static uint32 a_TaskCycleCnt[RTE_NO_RELEVANT_TASKS] =
{
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0,
  (uint32)0x0
};

/* ___GENERATOR_TAG___TASK_CYCLE_COUNTER___SECTION_END___
 * The GENERATOR_TAG above indicates the end of the taskCycleCounter implementation.
 * All the lines below the GENERATOR_TAG will not be changed by the codeGenerator at all.
 * DO NOT change or remove this comment block as it is needed by codeGenerator adding the rtaInstrumentation (GenerateRteStandardRtaInstrumentation)!!!
 */





/* The following GENERATOR_TAG indicates the start of the frameWorkHooks implementation.
 * All the lines above the GENERATOR_TAG will not be changed by the codeGenerator at all.
 * DO NOT change or remove this comment block as it is needed by codeGenerator adding the rtaInstrumentation (GenerateRteStandardRtaInstrumentation)!!!
 * ___GENERATOR_TAG___FRAMEWORK_HOOKS___SECTION_START___ */

FUNC(void, RTE_APPL_CODE) Rte_Task_Dispatch(TaskType task)
{
#if (RTM_FUNCTION_ENABLE == STD_OFF) //Use RTM
  /* ___GENERATOR_TAG___STANDARD_INSTRUMENTATION___SECTION_START___ */
  {
    uint8 u_idx = 0;
    /* Loop over TaskCfgLut and look for that entry for current task */
    for (u_idx = 0; RTE_NO_RELEVANT_TASKS > u_idx; u_idx++)
    {
      if(a_TASK_CFG_LUT[u_idx].taskId == task)
      {
        if(b_FALSE == a_TASK_CFG_LUT[u_idx].b_isExtendedTask)
        {
          /* Increment taskCycleCounter */
          a_TaskCycleCnt[u_idx]++;

          if(b_TRUE  == a_TASK_CFG_LUT[u_idx].b_taskRuntimeEnabled)
          {
            /* TaskRuntime measurement is enable and it is not an extended task -> generate a RtaStartEvent! */
            RTA_v_AddEvent(RTA_EVT_ALGOSTART, a_TASK_CFG_LUT[u_idx].u_globalId, a_TASK_CFG_LUT[u_idx].u_localId, a_TaskCycleCnt[u_idx]);
          }
        }
        /* Related entry found, terminate the loop immediately */
        break;
      }
    }
  }
  /* ___GENERATOR_TAG___STANDARD_INSTRUMENTATION___SECTION_END___ */
#else
# if(RTM_FUNC_TASK_MONITOR == STD_ON)
  SuspendAllInterrupts();
  uint8 coreid;
  coreid = GetCoreID();
  Rtm_StartThread(coreid, RTM_TSK, (uint16)task);
  ResumeAllInterrupts();
# endif
#endif
} /* Rte_Task_Dispatch */



FUNC(void, RTE_APPL_CODE) Rte_Task_EndHook(TaskType task)
{
#if (RTM_FUNCTION_ENABLE == STD_OFF) //Use RTM
  /* ___GENERATOR_TAG___STANDARD_INSTRUMENTATION___SECTION_START___ */
  {
    uint8 u_idx = 0;
    /* Loop over TaskCfgLut and look for the entry belonging to current task */
    for (u_idx = 0; RTE_NO_RELEVANT_TASKS > u_idx; u_idx++)
    {
      if(a_TASK_CFG_LUT[u_idx].taskId == task)
      {
        if(  (b_TRUE  == a_TASK_CFG_LUT[u_idx].b_taskRuntimeEnabled)
           &&(b_FALSE == a_TASK_CFG_LUT[u_idx].b_isExtendedTask    )
          )
        {
          /* TaskRuntime measurement is enable and it is not an extended task -> generate a RtaEndEvent! */
          RTA_v_AddEvent(RTA_EVT_ALGOEND, a_TASK_CFG_LUT[u_idx].u_globalId, a_TASK_CFG_LUT[u_idx].u_localId, (uint8)a_TaskCycleCnt[u_idx]);
        }
        /* Related entry found, terminate the loop immediately */
        break;
      }
    }
  }
  /* ___GENERATOR_TAG___STANDARD_INSTRUMENTATION___SECTION_END___ */
#else
# if(RTM_FUNC_TASK_MONITOR == STD_ON)
  SuspendAllInterrupts();
  uint8 coreid;
  coreid = GetCoreID();
  Rtm_EndThread(coreid, RTM_TSK, (uint16)task);
  ResumeAllInterrupts();
# endif
#endif
} /* Rte_Task_EndHook */



FUNC(void, RTE_APPL_CODE) Rte_Task_WaitEventRet(TaskType task, EventMaskType ev)
{
#if (RTM_FUNCTION_ENABLE == STD_OFF) //Use RTM
  /* ___GENERATOR_TAG___STANDARD_INSTRUMENTATION___SECTION_START___ */
  {
    uint8 u_idx = 0;
    /* Loop over TaskCfgLut and look for that entry for current task */
    for (u_idx = 0; RTE_NO_RELEVANT_TASKS > u_idx; u_idx++)
    {
      if(a_TASK_CFG_LUT[u_idx].taskId == task)
      {
        /* Increment taskCycleCounter */
        a_TaskCycleCnt[u_idx]++;
        if(b_TRUE  == a_TASK_CFG_LUT[u_idx].b_taskRuntimeEnabled)
        {
          /* TaskRuntime measurement is enable and it is not an extended task -> generate a RtaStartEvent! */
          RTA_v_AddEvent(RTA_EVT_ALGOSTART, a_TASK_CFG_LUT[u_idx].u_globalId, a_TASK_CFG_LUT[u_idx].u_localId, (uint8)a_TaskCycleCnt[u_idx]);
        }
        /* Related entry found, terminate the loop immediately */
        break;
      }
    }
  }
  /* ___GENERATOR_TAG___STANDARD_INSTRUMENTATION___SECTION_END___ */
#else
# if(RTM_FUNC_TASK_MONITOR == STD_ON)
  SuspendAllInterrupts();
  uint8 coreid;
  coreid = GetCoreID();
  Rtm_StartThread(coreid, RTM_TSK, (uint16)task);
  ResumeAllInterrupts();
# endif
#endif
} /* Rte_Task_WaitEventRet */



FUNC(void, RTE_APPL_CODE) Rte_Task_WaitEvent(TaskType task, EventMaskType ev)
{
#if (RTM_FUNCTION_ENABLE == STD_OFF) //Use RTM
  /* ___GENERATOR_TAG___STANDARD_INSTRUMENTATION___SECTION_START___ */
  {
    uint8 u_idx = 0;
    /* Loop over TaskCfgLut and look for that entry for current task */
    for (u_idx = 0; RTE_NO_RELEVANT_TASKS > u_idx; u_idx++)
    {
      if(a_TASK_CFG_LUT[u_idx].taskId == task)
      {
        if(b_TRUE  == a_TASK_CFG_LUT[u_idx].b_taskRuntimeEnabled)
        {
          /* TaskRuntime measurement is enable and it is not an extended task -> generate a RtaEndEvent! */
          RTA_v_AddEvent(RTA_EVT_ALGOEND, a_TASK_CFG_LUT[u_idx].u_globalId, a_TASK_CFG_LUT[u_idx].u_localId, (uint8)a_TaskCycleCnt[u_idx]);
        }
        /* Related entry found, terminate the loop immediately */
        break;
      }
    }
  }
  /* ___GENERATOR_TAG___STANDARD_INSTRUMENTATION___SECTION_END___ */
#else
# if(RTM_FUNC_TASK_MONITOR == STD_ON)
  SuspendAllInterrupts();
  uint8 coreid;
  coreid = GetCoreID();
  Rtm_EndThread(coreid, RTM_TSK, (uint16)task);
  ResumeAllInterrupts();
# endif
#endif
} /* Rte_Task_WaitEvent */




/* ___GENERATOR_TAG___FRAMEWORK_HOOKS___SECTION_END___
 * The GENERATOR_TAG above indicates the end of the frameWorkHooks implementation.
 * All the lines below the GENERATOR_TAG will not be changed by the codeGenerator at all.
 * DO NOT change or remove this comment block as it is needed by codeGenerator adding the rtaInstrumentation (GenerateRteStandardRtaInstrumentation)!!!
 */





/* The following GENERATOR_TAG indicates the start of the implementation of all the traceHoocFunctions.
 * All the lines above the GENERATOR_TAG will not be changed by the codeGenerator at all.
 * DO NOT change or remove this comment block as it is needed by codeGenerator adding the rtaInstrumentation (GenerateRteStandardRtaInstrumentation)!!!
 * ___GENERATOR_TAG___TRACE_HOOK_FUNCTIONS___SECTION_START___ */

/* All traceHooks for runnables called from different tasks. [SECTION_START] ********************************************************************/ 

/* All traceHooks for runnables called from different tasks. [SECTION_END] ********************************************************************/ 

/* ___GENERATOR_TAG___TRACE_HOOK_FUNCTIONS___SECTION_END___
 * The GENERATOR_TAG above indicates the end of the implementation of all the traceHoocFunctions.
 * All the lines below the GENERATOR_TAG will not be changed by the codeGenerator at all.
 * DO NOT change or remove this comment block as it is needed by codeGenerator adding the rtaInstrumentation (GenerateRteStandardRtaInstrumentation)!!!
 */
